\documentclass{labs}

\begin{document}
	\maketitlepage[1]	
	{Чисельно-аналітичне моделювання}
	{Математичне моделювання захворюваності на грип та його ускладнень з урахуванням можливої вакцинації населення}
	{Соловйов~C.~О.}
	{		&{Сахаров~С.~Ю.,}\\
			&{Вергун~К.~В.,}\\
			&{Борисенко~П.~Б.,}\\
			&{Федченко~О.~А.,}\\
			&{Дутчак~І.~О.}\\
	}
	{КМ-41м}
	
	\tableofcontents
	
	\intro
		Спалахи епідемій захворювань мають значний вплив на загальну смертність популяції. 
		Однією з таких хвороб є грип, вірус якого зазнає значного поширення, в результаті чого чималі маси індивідуумів інфікуються та переходять у стан хворих на грип. 
		
		Було проведено багато досліджень пов'язаних із поширенням вірусу грипу, через його вагомий вплив на кількість смертей в сучасному світі. Це стає особливо очевидним під час пандемій, найбільш помітними з яких 1918 пандемія грипу H1N1 (іспанка), яка вбила приблизно 50-100 млн осіб по всьому світу \cite{modeling} і останньою з яких є пандемія грипу H1N1 у 2009 році. До інших спалахів пандемії грипу відносять H2N2 пандемічний грип (Азіатський грип 1957) і H3N2 пандемічний грип (Гонконгський грип 1968). З тих часів пандемії грипу та епідемії становлять загрозу, тому вони важливі для розуміння.

	Як правило, захворювання що передаються вірусними агентами, такі як грип, надають імунітет проти повторної інфекції. Грип А є найбільш тяжким захворюванням, та взагалі спричиняє пандемію. Вірус цього типу має великий вплив на населення, зростає смертність, багато коштів витрачається лікарнями на дослідження вірусу та лікування хворих. Річні епідемії грипу зазвичай з'являються восени або взимку і впливають у середньому на $10-20\%$ загальної чисельності населення кожного року. Епідемії, як правило, результат частих дрібних антигенних змін вірусу.
		
		Проте, в ході аналізу смертних випадків, спричинених грипом, було встановлено, що грип відіграє опосередковану роль, оскільки смерть настає в результаті вторинних захворювань, збудником яких є бактеріальні інфекції.
		
Не можна обминути і той факт, що смертність від грипу та його ускладнень займає перше місце серед всіх
інфекційних захворювань \cite{lutau}. Окрім цього, грип може давати ускладнення у вигляді негоспітальних бактеріальних інфекцій нижніх дихальних шляхів, серед яких провідне місце займає пневмонія. За статистичними даними, пневмонія посідає перше місце серед причин летальності і смертності від усіх інфекційних захворювань, шосте --- серед усіх причин летальності і четверте --- серед причин смертності у хворих старше 65 років \cite{solov}.

Саме тому є актуальною розробка та дослідження моделі захворюваності на грип, а також дослідження методів впливу на захворювання задля зменшення впливу хвороби та її наслідків на життя та здоров'я населення.
		Кількість відомих адекватних моделей, які враховують описані залежності між грипом та вторинними бактеріальними захворюваннями, обмежена трьома, дві з яких виділяються своєю складністю через надмірність параметрів. 
		Аби мати можливість провести якісний аналіз, ми в даній практичні роботі розглянемо дещо простішу, але все ж адекватну математичну модель \cite{modeling}. 
		Якісний аналіз за допомогою моделі дозволить знайти максимальну кількість індивідуумів із симптомами грипу під час епідемії, виявити, чи відбудеться епідемія при заданих початкових параметрах для грипу та множини сприйнятливих осіб, а також інші наслідки для епідемії в результаті зміни тих чи інших параметрів. 


\chapter{Стаціонарні математичні моделі захворюваності на грип та його ускладнень}
\section{Математичні моделі без вакцинації}
			Математичні моделі цього класу описують взаємозв'язок між рівнями захворюваності на грип, хронічні бронхіти, пневмонію та інші гострі респіраторні вірусні інфекції (ГРВІ).

			Найпростішою модель не бере до розгляду ГРВІ, а бере до розгляду лише залежність захворюваності на пневмонію від захворюваності на грип та хронічні бронхіти:
			\begin{equation} \label{eq:HIP}
				P(I,H) = a_1I + a_2H -a_3\sqrt{IH} + a_4,
			\end{equation}
			де
			\begin{itemize}
				\item[$P$] --- рівень захворюваності на пневмонію;
				\item[$I$] --- рівень захворюваності на грип;
				\item[$H$] --- рівень захворюваності на хронічні бронхіти;
				\item[$a_1,\ldots,a_4$] --- параметри моделі.
			\end{itemize}

			Рівні захворюваності вимірюються у кількості хворих на 100000 населення.

			Параметри моделі можуть бути обчислені на основі статистичних даних про рівні захворюваності за допомогою регресійних методів, нейронних мереж, методом опорних векторів тощо.

			Може бути запропоновано складніша модель, що буде також враховувати випадки захворюваності на пневмонію як ускладнення інших крім грипу ГРВІ. Вона матиме подібний вид до~\eqref{eq:HIP}, а саме:
			\begin{equation} \label{eq:GHIP}
			\begin{aligned}
				P(I,H,G) = 	& a_1I + a_2H + a_3G + a_4\sqrt{IH} + \\
										& + a_5\sqrt{IG} + a_6\sqrt{GH} + a_7\sqrt[3]{IGH} + a_8, \\
			\end{aligned}
			\end{equation}
			де $G$ --- рівень захворюваності на ГРВІ (окрім грипу), $a_1 \cdots a_8$ --- параметри моделі.

		\section{Математичні моделі з вакцинацією} \label{section:static_vac}
			Моделювання такого управління захворюваністю, як вакцинація здійснюється при припущенні, що зменшення чисельності хворих на грип на деяку частку, що характеризує дієвість програми вакцинації.

			Ефективність вакцинації залежить від наступних параметрів:
			\begin{itemize}
				\item[$b_i$] --- бюджет на закупівлю вакцин в певному регіоні;
				\item[$N_i$] --- кількість населення в певному регіоні;
				\item[$Cost$] --- вартість однієї дози вакцини;
				\item[$Ef$] --- ефективність вакцини.
			\end{itemize}

			Введемо параметр $\gamma$, --- що характеризує управління захворювання за рахунок вакцинації: 
			\begin{equation} \label{eq:gamma}
				\gamma = \frac{b_i \cdot Ef}{Cost \cdot N_i}.
			\end{equation}

			З впровадженням програми вакцинації та урахуванням~\eqref{eq:gamma}, залежність захворюваності на пневмонію від захворювання на інші патології представляє цільову функцію, яка може бути використана при розрахунку оптимальної стратегії вакцинації населення:
			\begin{equation} \label{eq:GHIP_with_vaccination}
				\begin{aligned}
					&\Sigma \bar{P_i}(I,H,G) = \Sigma [ a_1(1 - \gamma)I_i + a_2H_i + a_3G_i + \\ 
					& + a_4\sqrt{(1 - \gamma)I_iH_i} + a_5\sqrt{(1 - \gamma)I_iG_i} + a_6\sqrt{G_iH_i} + \\
					& + a_7\sqrt[3]{(1 - \gamma)I_iG_iH_i} + a_8 ] \longrightarrow min.
				\end{aligned}
			\end{equation}
			За умови: $\Sigma b_i = B \equiv const$.
			
			Або цільова функція може бути представлена як різниця захворюваностей на пневмонію при застосуванні вакцинації:
			\begin{equation} \label{eq:deltaP}
				\begin{aligned}
					\Sigma \Delta P_i(I,H,G) &= \Sigma (P_i - \bar{P_i}) = \Sigma [ a_1\gamma I_i - \\
					& - (a_4\sqrt{I_iH_i} + a_5\sqrt{I_iG_i})(1 - \sqrt{1 - \gamma}) + \\
					& + a_7\sqrt[3]{I_iG_iH_i}(1 - \sqrt[3]{1 - \gamma}) ] \longrightarrow max.
				\end{aligned}
			\end{equation}
			За умови: $\Sigma b_i = B \equiv const$.

			Ця величина може бути використана при розрахунку оптимальної стратегії вакцинації населення. А саме, оптимальній стратегії буде відповідати максимальне значення $\Delta P$. 
		
\chapter{Динамічні математичні моделі захворюваності на грип та його ускладнень}
\section{Математична модель без вакцинації}
			Відповідно до \cite{modeling} динамічна модель захворюваності на грип та його ускладнень може бути представлена із деякими обмеженнями за допомогою ланцюга Маркова, де стани асоційовані із класами популяції (рис.~\ref{fig:chain_without_vaccinating}):
			
			\begin{itemize}
				\item[$ S $] --- клас тих, хто ще не був інфікований штамом вірусу грипу;
				\item[$ H $] --- клас тих, хто захворів хронічним бронхітом.
				\item[$ G, G' $] --- класи інфікованих штамом вірусу грипу із наявними зовнішніми симптомами; 
				\item[$ R, R' $] --- класи інфікованих іншими ГРВІ, окрім грипу;
				\item[$ GR, G'R' $] --- клас інфікованих ГРВІ та грипом;
				\item[$ Z, Z' $] --- класи тих, хто повністю видужав та має відновлений імунітет і не захворіє повторно грипом, а значить, і вторинною бактеріальною пневмонією;
				\item[$ P, P' $] --- класи тих, хто захворів пневмонією.
			\end{itemize}
			
			При цьому, усі стани, параметри та коефіцієнти позначені штрихами тут, і далі в цьому розділі, означають такі, що протікають поряд з хронічним бронхітом.
			\begin{figure}[!htp]
				\centering
				\includegraphics[scale=0.42]{PNG/Dynamic_model.png}
				\caption{Динамічна модель захворюваності на грип та його ускладнень}
				\label{fig:chain_without_vaccinating}
			\end{figure}
			
			Коефіцієнти, що позначені на моделі означають:
			\begin{align}
				\left\{\begin{aligned}
					p_1 &= \text{пневмонія після грипу};\\
					p_2 &= \text{пневмонія після ГРВІ};\\
					p_3 &= \text{пневмонія після грипу та ГРВІ};\\
					p_4 &= \text{пневмонія спричинена іншими факторами},
				\end{aligned} 
				\right.
			\end{align}
			де:
			\begin{equation}
			\begin{aligned}
				p_1 &= \frac{P_G}{P_G+P_R+P_{GR}+P_S};\\
				p_2 &= \frac{P_R}{P_G+P_R+P_{GR}+P_S};\\
				p_3 &= \frac{P_{GR}}{P_G+P_R+P_{GR}+P_S};\\
				p_4 &= \frac{P_S}{P_G+P_R+P_{GR}+P_S};\\
			\end{aligned}
			\label{eq:1}
			\end{equation}
			
			Коефіцієнт $\alpha$ характеризує ймовірність захворіти хронічним бронхітом здоровою людиною без імунітету.
			
			Параметри, що характеризують захворюваність на грип, ГРВІ, грип та ГРВІ одночасно, та пневмонію, відповідно:
			\begin{equation}
			\begin{aligned}
				P_G 		&= \int_0^t [ \beta_6 G  - y_3p_1P]dt;\\
				P_R 		&= \int_0^t [ \beta_7 R  - y_3p_2P]dt;\\
				P_{GR} 	&= \int_0^t [ \beta_8 GR - y_3p_3P]dt;\\
				P_S 		&= \int_0^t [ (1-\alpha)\beta_5 S  - y_3(z_1+z_2+z_4)Z - \beta_3p_4P]dt;\\
			\end{aligned}
			\label{eq:2}
			\end{equation}
			
			При цьому враховується можливий присутній імунітет проти захворювань:
			\begin{equation}
			\begin{aligned}
				z_1 &= \frac{Z_G}		{\Sigma Z_{i}} - \text{імунні проти грипу};	\\
				z_2 &= \frac{Z_R}		{\Sigma Z_{i}} - \text{імунні проти ГРВІ};	\\
				z_3 &= \frac{Z_{P}}	{\Sigma Z_{i}} - \text{імунні проти пневмонії};	\\
				z_4 &= \frac{Z_{GR}}{\Sigma Z_{i}} - \text{імунні проти грипу та ГРВІ};	\\
				z_5 &= \frac{Z_{GP}}{\Sigma Z_{i}} - \text{імунні проти грипу та пневмонії};	\\
				z_6 &= \frac{Z_{RP}}{\Sigma Z_{i}} - \text{імунні проти ГРВІ та пневмонії};	\\
				z_7 &= \frac{Z_{GRP}}{\Sigma Z_{i}} - \text{імунні проти ГРВІ, грипу та пневмонії};	\\
			\end{aligned}
			\label{eq:3}
			\end{equation}
			де ймовірності виздоровлення рівні:
			\begin{equation}
			\begin{aligned}
				Z_G			&= \int_0^t[y_1G-\beta_5z_1Z-\beta_2[R+GR+R'+R'G']z_1Z-w_1z_1Z]dt;\\
				Z_R			&= \int_0^t[y_2R-\beta_5z_2Z-\beta_1[G+GR+G'+G'R']z_2Z-w_2z_2Z]dt;\\
				Z_{P}		&= \int_0^t[y_3p_4P-\beta_1[G+GR+G'+G'R']z_3Z-\\
								&-\beta_2[R+GR+R'+R'G']z_3Z-w_3z_3Z]dt;\\
				Z_{GR}	&= \int_0^t[y_4GR-\beta_5z_4Z-w_4z_4Z]dt;\\
				Z_{GP}	&= \int_0^t[y_3p_1P-\beta_2[R+GR+R'+R'G']z_5Z-w_5z_5Z]dt;\\
				Z_{RP}	&= \int_0^t[y_3p_2P-\beta_1[G+GR+G'+G'R']z_6Z-w_6z_6Z]dt;\\
				Z_{GRP}	&= \int_0^t[y_3p_3P-w_7z_7Z]dt.\\
			\end{aligned}
			\label{eq:4}
			\end{equation}
			При цьому $\beta_i$ --- функціонально залежні від:
			\begin{equation}
				\beta_i = \beta_i(1+b_1cos(2\Pi t+\phi).
			\end{equation}
			Повністю аналогічно визначаються відповідні параметри для випадку захворюваності на хронічний бронхіт, окрім того, що всі входження коефіцієнта $(1-\alpha)$ заміняються на $\alpha$.
		\section{Математична модель з вакцинацією}
			Оскільки вакцинація впливає на початкові умови задачі, дещо змінюється вигляд ланцюга Маркова (рис.~\ref{fig:chain_vaccinating}).
			\begin{figure}[!htp]
				\centering
				\includegraphics[scale=0.42]{PNG/Dynamic_model_vac.png}
				\caption{Динамічна модель захворюваності на грип та його ускладнень з урахуванням вакцинацій}
				\label{fig:chain_vaccinating}
			\end{figure}
			
			Тут коефіцієнти $\gamma$ та $\gamma'$ характеризують регулювання захворюваннями за рахунок вакцинації та мають вигляд, який було показано вище (\ref{eq:gamma}), в стаціонарній моделі.
			
			Також, більшість параметрів моделі залишаються незмінними, окрім:
			\begin{equation}
			\begin{aligned}
				Z_G			&= \int_0^t[y_1G+\gamma (1-\alpha) S-\beta_5z_1Z-\\
				&-\beta_2[R+GR+R'+R'G']z_1Z-w_1z_1Z]dt,
			\end{aligned}
			\label{eq:6}
			\end{equation}
			та відповідного коефіцієнта для випадку захворювання на хронічний бронхіт:
			\begin{equation}
			\begin{aligned}
				Z_G'			&= \int_0^t[y_1'G'+\gamma \alpha S'-\beta_5'z_1'Z'-\\
				&-\beta_2'[R+GR+R'+R'G']z_1'Z'-w_1'z_1'Z']dt.
			\end{aligned}
			\label{eq:6}
			\end{equation}
	\chapter{Визначення коефіцієнтів та чисельний аналіз моделі (на прикладі стаціонарної моделі)}
		
		Приклад роботи моделі:
		\begin{enumerate}
		\item Для визначення параметрів стаціонарної моделі були використані статистичні дані захворюваності населення України за один рік. Ефективність вакцини $Ef = 0.85$, а її ціна $cost = 10\$$. Загальний бюджет виділений на вакцину $B$ пропорційний кількості людей у регіоні $N$ та відноситься як $1:100$.
		Для моделей~\eqref{eq:HIP} та~\eqref{eq:GHIP} шляхом застосування методу найменших квадратів було складено регресійну модель.
		За допомогою системи комп'ютерної математики Matlab було проведено регресійний аналіз та отримано значення невідомих параметрів моделей~\eqref{eq:HIP} та~\eqref{eq:GHIP}:
		\begin{equation} \label{eq:params}
			\begin{aligned}
				& \bar{a}_{HIP}  = (0.4375\ 0.0000\ -0.4463\ 389.1645)^T; \\
				& \bar{a}_{GHIP} = (1.0000\ 0.0000\  0.0076\ -1.7130\  -\\
				& -0.2987\ -0.0988\ 1.1349\ 367.4740)^T.
			\end{aligned}
		\end{equation}
		\item Адекватність моделі ~\eqref{eq:HIP} та ~\eqref{eq:GHIP} наведено на рис.~\ref{fig:adequacyHIP} та рис.~\ref{fig:adequacyGHIP} відповідно.
		\begin{figure}[!htp]
				\centering
				\includegraphics[scale=0.7]{PNG/adequacy_HIP.png}
				\caption{Адекватність моделі ~\eqref{eq:HIP}}
				\label{fig:adequacyHIP}
			\end{figure}
			\begin{figure}[!htp]
				\centering
				\includegraphics[scale=0.7]{PNG/adequacy_GHIP.png}
				\caption{Адекватність моделі ~\eqref{eq:GHIP}}
				\label{fig:adequacyGHIP}
			\end{figure}
		\item Аналіз чутливості. 
		
		Оскільки поставлена задача оптимізації $\Sigma \bar{P} \longrightarrow max$ при перерозподілені бюджетів $b_i$ між регіонами, при умові $\Sigma b_i = B \equiv const$. Графіки $P_{max} = f(cost)$, $P_{max} = f(B)$, $P_{max} = f(cost, B)$ подано на рис.~\ref{fig:PcostHIP}, рис.~\ref{fig:PBHIP} та рис.~\ref{fig:PBcostHIP} для моделі ~\eqref{eq:HIP} відповідно, а на рис.~\ref{fig:PcostGHIP}, рис.~\ref{fig:PBGHIP} та рис.~\ref{fig:PBcostGHIP} для моделі ~\eqref{eq:GHIP} відповідно, де $cost$ --- ціна вакцини, $B$ --- загальний бюджет.
			\begin{figure}[!htp]
				\centering
				\includegraphics[scale=0.7]{PNG/Pcost_HIP.png}
				\caption{Залежність максимальної кількості потенційно не захворілих від ціни вакцини для моделі ~\eqref{eq:HIP}}
				\label{fig:PcostHIP}
			\end{figure}
			\begin{figure}[!htp]
				\centering
				\includegraphics[scale=0.7]{PNG/PB_HIP.png}
				\caption{Залежність максимальної кількості потенційно не захворілих від обсягу виділеного загального бюджету для моделі ~\eqref{eq:HIP}}
				\label{fig:PBHIP}
			\end{figure}
			\begin{figure}[!htp]
				\centering
				\includegraphics[scale=0.65]{PNG/PBcost_HIP.png}
				\caption{Залежність максимальної кількості потенційно не захворілих від ціни вакцини та обсягу виділеного загального бюджету для моделі ~\eqref{eq:HIP}}
				\label{fig:PBcostHIP}
			\end{figure}
			
				\begin{figure}[!htp]
				\centering
				\includegraphics[scale=0.7]{PNG/Pcost_GHIP.png}
				\caption{Залежність максимальної кількості потенційно не захворілих від ціни вакцини для моделі ~\eqref{eq:HIP}}
				\label{fig:PcostGHIP}
			\end{figure}
			\begin{figure}[!htp]
				\centering
				\includegraphics[scale=0.7]{PNG/PB_GHIP.png}
				\caption{Залежність максимальної кількості потенційно не захворілих від обсягу виділеного загального бюджету для моделі ~\eqref{eq:HIP}}
				\label{fig:PBGHIP}
			\end{figure}
			\begin{figure}[!htp]
				\centering
				\includegraphics[scale=0.65]{PNG/PBcost_GHIP.png}
				\caption{Залежність максимальної кількості потенційно не захворілих від ціни вакцини та обсягу виділеного загального бюджету для моделі ~\eqref{eq:HIP}}
				\label{fig:PBcostGHIP}
			\end{figure}
		\item Результати:
		\begin{itemize}
		\item Відносна усереднена похибка моделей ~\eqref{eq:HIP} та ~\eqref{eq:GHIP} відповідно $0.1870$ та $0.1828$.
		\item Кореляція побудованих графіків $P_{th}$ та $P_{pr}$ обох моделей близька до одиниці ($r \approx 1$).
		\item При збільшенні ціни вакцини, зменшується кількість потенційно здорових людей,  а при збільшенні бюджету --- їх кількість збільшується.
		\end{itemize}
\end{enumerate}

		Після отримання розрахованих параметрів моделей, можемо обчислювати ефективність вакцинації за допомогою побудованої моделі~\eqref{eq:GHIP_with_vaccination}.
		В Matlab було реалізовано модуль для обчислення ефективності вакцинації (Дод. 1) залежно від варіювання параметрів моделі, що наведені у розділі~\ref{section:static_vac}.

		%Розрахунки показали, що модель~\eqref{eq:GHIP} дає змогу дещо точніше описувати процеси захворюваності на пневмонію: її відносна похибка становить $18.725~\%$, в той час як похибка моделі~\eqref{eq:HIP} становить $19.36~\%$.

		Отримані результати дали змогу оцінити вплив вакцинації проти грипу на рівень захворюваності на пневмонію.
		%Це приблизно відповідає вакцинації 55-60~\% населення вакциною з ефективністю близько 85~\%. Згідно результатів розрахунків така вакцинація знизить захворюваність на пневмонію на 61~\%.

\conclusion
		
\begin{itemize}
\item В Україні пневмонія частіше виникає як ускладнення після грипу, ніж після інших ГРВІ чи бронхіту.
\item Побудовано стаціонарну та динамічну моделі для оцінки впливу вакцинації населення на можливий перебіг його захворюваності на грип та його ускладнення.
\item Детально досліджено стаціонарну модель при різних вхідних параметрах. Показано, що для забезпечення найменшої кількості захворюваності, на грип та його ускладнення, населення загалом, важливішим є охоплення вакцинацією якомога більшої кількості населення, що при фіксованому бюджеті, вимагає обирати дешевші (до деякого рівня) вакцини.
\end{itemize}

		При дослідженні такого роду моделей слід враховувати, що статистичні дані можуть недостатньо точно відображати реальну картину захворюваності, оскільки значна кількість випадків грипу та ГРВІ не реєструється у закладах охорони здоров'я і, відповідно, не потрапляють до жодної статистики, що саме по собі є причиною збільшення похибки моделі.  

\begin{thebibliography}

\bibitem{modeling} 
Henneman~K. Mathematical modeling of influenza and a secondary bacterial infection / K.~Henneman, D.~Van~Peursem, V.~Huber // WSEAS TRANSACTIONS on BIOLOGY and BIOMEDICINE. --- 2013. --- Vol. 10 --- P. 1--11.
		
\bibitem{interacting} 
Dang~U. Can Interactions between Timing of Vaccine-Altered Influenza Pandemic Waves and Seasonality in Influenza Complications Lead to More Severe Outcomes? / U.~Dang, C.~Bauch // PLoS ONE. --- 2011. --- Vol. 6 --- P. 1--9.
		
\bibitem{lutau}
Lutay M. I. Atherosclerosis: a modern view of the pathogenesis / Ukr. cardol. mag. --- 2003. No. 1. --- P. 12-16.	

\bibitem{solov}	
Дзюблик Я.О. РЕТРОСПЕКТИВНИЙ АНАЛІЗ ЗАХВОРЮВАНОСТІ НА ГРИП ТА ПНЕВМОНІЇ В ОКРЕМИХ РЕГІОНАХ УКРАЇНИ ТА СИНЕРГІЗМУ МІЖ НИМИ / Дзюблик Я.О., Соловйов С.О. // Проблеми екології та медицини. --- 2014. Том 18 N3-4 --- ст. 19

\end{thebibliography}
	
\append{Вихідні коди}
	\begin{lstlisting}[language=Matlab, basicstyle=\tiny, breaklines=true]
function [] = VC_Model(filename, years, type)
    if nargin < 3
        type = 'HIP';
    end
    if nargin < 2
        years = 1;
    end
    
    function P = model(a)
        if strcmp(type,'HIP')
            P = a(1) * I + a(2) * H - a(3) * sqrt(I .* H) + a(4);
        else
            P = a(1) * I + a(2) * H + a(3) * G +...
                a(4) * sqrt(I .* H) + a(5) * sqrt(I .* G) + a(6) * sqrt(G .* H) +...
                a(7) * nthroot(I.*H.*G, 3) + a(8);
        end
        %P = a(1) * I.^2 + a(2) * H.^2 + a(3) * I .* H + a(4) * I + a(5) *H + a(6);
    end

    function [a, value] = fit_parameters(P)
        f = @(a) norm(model(a) - P);
        if strcmp(type,'HIP')
            start_point = [0 0 0 0];
            lb = [0 0 -Inf -Inf];
            ub = [1 1 Inf Inf];
        else
            start_point = [0 0 0 0 0 0 0 0];
            lb = [0 0 0 -Inf -Inf -Inf -Inf -Inf];
            ub = [1 1 1 Inf Inf Inf Inf Inf];
        end
        options = optimset('MaxFunEvals', 10000, 'MaxIter', 10000);
        [a, value] = fmincon(f, start_point,[],[],[],[],lb,ub,[],options);
    end

    function P = p(B, cost, N, Ef)
        P = B ./ N * Ef / cost;
    end

    function [] = draw(P, I, H, color)
        S = 10;
        scatter3(I, H, P, S, color);
        xlabel('Influenza, I');
        ylabel('Bronchitis, H');
        zlabel('Pneumonia, P');
    end

    function [I, P, H, G] = readFile(filename, h)
        data = dlmread(filename);
        I = data(:,1:h); I = I(:);
        P = data(:,h+1:2*h); P = P(:);
        H = data(:,2*h+1:3*h); H = H(:);
        if ~strcmp(type,'HIP')
            G = data(:,3*h+1:4*h); G = G(:);
        else
            G = 0;
        end
    end

    function P = modelVC(a, B, N, cost, Ef)
        gamma = p(B, cost, N, Ef);
        if strcmp(type,'HIP')
            P = a(1) .* I .* (1-gamma) - a(3) .* sqrt(I .* H) * (1-sqrt(gamma));
        else
            P = (1 - gamma) * a(1) * I +...
                (sqrt(gamma) - 1) * (a(4) * sqrt(I.*H) + a(5) * sqrt(I.*G)) +...
                (1 - nthroot(gamma, 3)) * a(7) * nthroot(I.*H.*G, 3);
        end
    end

    % read data from file
    [I, P, H, G] = readFile(filename, years);
    % feat parameters
    a = fit_parameters(P);
    % compute error
    P_exp = model(a);
    eps = abs(P - P_exp);
    % display results
    display(['Model parameters a = ' num2str(a)]);
    display(['Maximum error = ' num2str(max(eps))]);
    display(['Mean error = ' num2str(mean(eps))]);
    mean(eps)/min(P)
    mean(eps)/max(P)
    mean(eps)/mean(P)
    % vaccination
    P_vc = modelVC(a, 1, 2, 1, 0.85);
    z = P_vc ./ P;
    display('People saved:');
    disp(z);
    display(['Maximum people saved = ' num2str(max(z))]);
    display(['Mean people saved = ' num2str(mean(z))]);
end
	\end{lstlisting}

\end{document}

